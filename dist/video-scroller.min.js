/***
 * VideoScroller.js
 * URL: https://github.com/finnursig/VideoScroller
 * Author: Finnur SigurÃ°sson (finnursigu@gmail.com)
 */

!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.VideoScroller=e()}(this,function(){"use strict";var t={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return.5>t?2*t*t:-1+(4-2*t)*t},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return.5>t?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return.5>t?16*t*t*t*t*t:1+16*--t*t*t*t*t}},e=function(t,e,i){e&&Object.defineProperties(t,e),i&&Object.defineProperties(t.prototype,i)},i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function n(e){var r=this,o=e.el,s=e.transitionTime,a=void 0===s?2e3:s,u=e.invert,c=void 0===u?!1:u,l=e.scrollTimeout,h=void 0===l?300:l,d=e.easingFunction,f=void 0===d?t.easeOutQuint:d,g=e.debug,v=void 0===g?!1:g;if(i(this,n),!o)throw new Error("Missing video element ref.");this.el=o,this.transitionTime=a,this.invert=c,this.scrollTimeout=h,this.easingFunction="function"==f?f:t[f],this.debug=v,n.isCompatibleWithCurrentBrowser()&&(this.el.getAttribute("data-src")?this.getVideo():this.el.readyState>1?this.init():this.el.addEventListener("loadeddata",function(){return r.init()}))}return e(n,{isCompatibleWithCurrentBrowser:{value:function(){return window.URL&&window.URL.createObjectURL&&XMLHttpRequest?!0:!1},writable:!0,configurable:!0}},{getVideo:{value:function(){var t=this,e=new XMLHttpRequest;e.open("get",this.el.getAttribute("data-src"),!0),e.responseType="blob",e.withCredentials=!1,e.onload=function(){t.el.addEventListener("loadeddata",function(){return t.init()}),t.el.src=window.URL.createObjectURL(e.response)},e.onprogress=function(t){var e=Math.round(t.loaded/t.total*100);console.log("onprogress",e+"%")},e.onreadystatechange=function(){console.log("onreadystatechange",e.readyState)},e.send()},writable:!0,configurable:!0},init:{value:function(){var t=this;this.videoDuration=this.el.duration,this.debug&&(this.el.controls=!0),this.el.className=this.el.className+" video-scroller-ready",window.addEventListener("scroll",function(){return t.onScroll()},!1),this.start(this.inView(this.el))},writable:!0,configurable:!0},start:{value:function(t){var e=this;this.startTime=Date.now(),this.currentTime=this.el.currentTime,this.targetDuration=this.videoDuration*t-this.el.currentTime,this.debug&&console.log("time=",t,"targetTime=",this.currentTime,"targetDuration",this.targetDuration),this.intervalTimer||(this.intervalTimer=setInterval(function(){return e.loop()},60))},writable:!0,configurable:!0},loop:{value:function(){var t=(Date.now()-this.startTime)/this.transitionTime,e=this.easingFunction(t);t>=1||(this.el.currentTime=this.currentTime+this.targetDuration*e,this.el.pause())},writable:!0,configurable:!0},inView:{value:function(){var t=window.innerHeight,e=this.el.getBoundingClientRect().top,i=this.el.offsetHeight,n=e-t;n>0&&(n=0);var r=Math.abs(n)/(t+i);return this.invert||(r=1-r),r>1?1:0>r?0:r},writable:!0,configurable:!0},onScroll:{value:function(){var t=this;this.isWaiting||(this.isWaiting=!0,setTimeout(function(){t.isWaiting=!1;var e=t.inView(t.el);void 0!==e&&t.start(e)},this.scrollTimeout))},writable:!0,configurable:!0}}),n}();return n});